<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Premium Animated To-Do — Ultra</title>
<meta name="description" content="Animated premium to-do list app — single file" />
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style>
  /* ---------- Base & Theme ---------- */
  :root{
    --bg-1: #060617;
    --bg-2: #07112a;
    --card: rgba(255,255,255,0.04);
    --muted: #9aa3b2;
    --glass: rgba(255,255,255,0.03);
    --accent-a: #7c3aed;
    --accent-b: #06b6d4;
    --success: #10b981;
    --danger: #ef4444;
    --radius: 14px;
    --maxw: 1100px;
  }
  html,body{height:100%;}
  body{
    margin:0;
    min-height:100vh;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    color: #e6eef8;
    background: radial-gradient(1200px 600px at 10% 20%, rgba(124,58,237,0.10), transparent),
                radial-gradient(900px 400px at 90% 80%, rgba(6,182,212,0.08), transparent),
                linear-gradient(180deg,var(--bg-1),var(--bg-2));
    display:flex;
    align-items:center;
    justify-content:center;
    padding:36px 20px;
  }

  /* ---------- Premium animated shapes (SVG + CSS) ---------- */
  .bg-shapes {
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
    overflow: visible;
  }
  .shape {
    position:absolute;
    filter: blur(34px) saturate(120%);
    opacity: .9;
    transform-origin: center;
    mix-blend-mode: screen;
    animation: float 10s ease-in-out infinite;
  }
  .shape.s1 { left: -10%; top: 5%; width: 520px; height: 520px; background: linear-gradient(135deg, var(--accent-a), #a78bfa); animation-duration: 12s; border-radius: 40% 60% 50% 50% / 40% 30% 70% 60%; }
  .shape.s2 { right: -5%; bottom: -10%; width: 520px; height: 520px; background: linear-gradient(135deg, var(--accent-b), #67e8f9); animation-duration: 14s; border-radius: 50% 40% 60% 30% / 40% 60% 30% 70%; }
  .shape.s3 { left: 20%; bottom: 50%; width: 300px; height: 300px; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.04), transparent); animation-duration: 18s; border-radius: 50%; opacity: .6; transform: rotate(10deg) scale(.9) }
  @keyframes float {
    0% { transform: translateY(0) rotate(0deg) }
    50% { transform: translateY(-24px) rotate(6deg) }
    100% { transform: translateY(0) rotate(0deg) }
  }

  /* ---------- App Layout ---------- */
  .app {
    position: relative;
    width: 100%;
    max-width: var(--maxw);
    z-index: 2;
    display: grid;
    grid-template-columns: 1fr 360px;
    gap: 18px;
    align-items: start;
  }

  .panel {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    border-radius: var(--radius);
    padding: 18px;
    box-shadow: 0 10px 40px rgba(2,6,23,0.6);
    border: 1px solid rgba(255,255,255,0.03);
    backdrop-filter: blur(6px);
  }
  header.app-head { display:flex; align-items:center; gap:12px; margin-bottom:8px }
  header.app-head h1 { font-size:20px; margin:0 }
  header.app-head p.small { margin:0; color:var(--muted); font-size:13px }

  /* ---------- Controls ---------- */
  .controls { display:flex; gap:8px; align-items:center; margin-top:6px }
  .btn {
    background: linear-gradient(90deg,var(--accent-a),var(--accent-b));
    padding:8px 12px;
    border-radius:10px;
    color:white;
    border:0;
    cursor:pointer;
    box-shadow: 0 8px 26px rgba(7,12,29,0.45);
    font-weight:600;
  }
  .btn.ghost {
    background: transparent;
    border:1px solid rgba(255,255,255,0.04);
    color:var(--muted);
    box-shadow:none;
  }
  .small { font-size:13px; color:var(--muted) }

  input[type="text"], input[type="date"], select, textarea {
    width:100%;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,0.04);
    background: rgba(255,255,255,0.02);
    color:inherit;
    font-size:14px;
    outline: none;
  }
  input[type="text"]::placeholder, textarea::placeholder { color: var(--muted) }

  /* ---------- Task List ---------- */
  .task-list { display:flex; flex-direction:column; gap:12px; margin-top:12px; max-height:68vh; overflow:auto; padding-right:6px; }
  .task {
    display:grid;
    grid-template-columns: 64px 1fr 120px;
    gap:12px;
    align-items:center;
    padding:12px;
    border-radius:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
    border:1px solid rgba(255,255,255,0.02);
    transition: transform .18s ease, box-shadow .18s ease;
  }
  .task:hover{ transform: translateY(-6px); box-shadow: 0 18px 40px rgba(7,12,29,0.6); }
  .task .left {
    display:flex; flex-direction:column; align-items:center; gap:8px;
  }
  .avatar {
    width:56px; height:56px; border-radius:50%;
    display:grid; place-items:center; font-weight:700; color:white;
    background: linear-gradient(180deg,var(--accent-a),var(--accent-b));
    box-shadow: 0 8px 26px rgba(124,58,237,0.12);
  }
  .meta { color:var(--muted); font-size:13px }

  .task .title { font-weight:700; font-size:15px; }
  .task .desc { font-size:13px; color:var(--muted); margin-top:6px }

  .badges { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px }
  .badge { background: rgba(255,255,255,0.02); padding:6px 8px; border-radius:8px; font-size:12px; color:var(--muted); border:1px solid rgba(255,255,255,0.02) }

  .progress { width:100%; height:10px; background: rgba(255,255,255,0.03); border-radius:999px; overflow:hidden; }
  .progress > i { display:block; height:100%; background: linear-gradient(90deg,var(--accent-a),var(--accent-b)); width:0%; transition: width .6s cubic-bezier(.2,.9,.2,1); }

  .actions { display:flex; gap:8px; justify-content:flex-end; align-items:center; }

  /* ---------- Side Panel ---------- */
  .side { display:flex; flex-direction:column; gap:12px }
  .stat { padding:12px; border-radius:10px; background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border:1px solid rgba(255,255,255,0.02) }
  .list-compact { display:flex; flex-direction:column; gap:8px; }

  /* ---------- Footer ---------- */
  footer { text-align:center; color:var(--muted); font-size:13px; margin-top:12px }

  /* ---------- Responsive ---------- */
  @media (max-width: 980px) {
    .app { grid-template-columns: 1fr; padding-bottom:40px }
    .task { grid-template-columns: 56px 1fr; }
    .task .actions { grid-column: 1 / -1; justify-content:space-between }
    .side { order: -1 }
  }

  /* ---------- Tiny helpers ---------- */
  .muted { color:var(--muted) }
  .flex { display:flex; gap:8px; align-items:center }
  .right { margin-left:auto; }
  .hidden { display:none }
  .pill { padding:6px 8px; border-radius:999px; font-size:13px; background: rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03) }

</style>
</head>
<body>
  <!-- Animated background shapes -->
  <div class="bg-shapes" aria-hidden="true">
    <div class="shape s1"></div>
    <div class="shape s2"></div>
    <div class="shape s3"></div>
  </div>

  <div class="app" role="application" aria-label="Premium To-Do App">
    <!-- Main column -->
    <div class="panel" style="min-height:80vh;">
      <header class="app-head">
        <div>
          <h1>Premium To-Do • Animated</h1>
          <p class="small">Keyboard: <span class="pill">N</span> new task • Auto-saved locally</p>
        </div>
        <div class="right">
          <button id="themeToggle" class="btn btn-small ghost">Toggle Theme</button>
        </div>
      </header>

      <!-- Create form -->
      <section>
        <div style="display:grid;grid-template-columns:1fr 220px;gap:10px;align-items:start">
          <div>
            <input id="taskTitle" type="text" placeholder="Task title (required)" />
            <div style="display:flex;gap:8px;margin-top:8px">
              <input id="taskSub" type="text" placeholder="Comma-separated subtasks (optional)" />
              <select id="taskPriority" style="width:140px">
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="high">High</option>
              </select>
            </div>
            <textarea id="taskNotes" rows="2" placeholder="Notes (optional)" style="margin-top:8px"></textarea>
          </div>
          <div style="display:flex;flex-direction:column;gap:8px">
            <input id="taskDue" type="date" />
            <select id="taskCategory">
              <option value="General" selected>General</option>
              <option>Work</option>
              <option>Study</option>
              <option>Personal</option>
            </select>
            <div style="display:flex;gap:8px">
              <button id="addBtn" class="btn" style="flex:1">Add Task</button>
              <button id="clearBtn" class="btn ghost" title="Clear all tasks">Clear</button>
            </div>
            <div class="small muted">Tip: Add subtasks to auto-calc completion %</div>
          </div>
        </div>
      </section>

      <!-- Search & filters -->
      <section style="margin-top:12px; display:flex;gap:8px;align-items:center;">
        <input id="searchInput" type="text" placeholder="Search tasks, notes, categories..." style="flex:1" />
        <select id="filterCategory" class="pill">
          <option value="all">All Categories</option>
          <option>General</option><option>Work</option><option>Study</option><option>Personal</option>
        </select>
        <select id="filterStatus" class="pill">
          <option value="all">Any status</option>
          <option value="completed">Completed</option>
          <option value="pending">Pending</option>
        </select>
        <select id="sortBy" class="pill">
          <option value="created">Newest</option>
          <option value="due">Due date</option>
          <option value="priority">Priority</option>
          <option value="percent">Completion</option>
        </select>
      </section>

      <!-- Task list -->
      <section class="task-list" id="tasksList" aria-live="polite"></section>

      <footer>
        <div style="display:flex;gap:12px;align-items:center;justify-content:center">
          <button id="exportBtn" class="btn ghost">Export JSON</button>
          <button id="importBtn" class="btn ghost">Import JSON</button>
          <input id="importFile" type="file" accept="application/json" class="hidden" />
        </div>
        <div style="margin-top:8px" class="small muted">Made with ❤️ — Save & share your productivity</div>
      </footer>
    </div>

    <!-- Side panel -->
    <aside class="panel side">
      <div class="stat">
        <div style="display:flex;align-items:center;gap:8px">
          <strong>Summary</strong>
          <div class="right small muted" id="summarySmall">0 tasks • 0%</div>
        </div>
        <div style="margin-top:8px" class="list-compact">
          <div class="small muted" id="counts">Completed: 0 • Pending: 0</div>
          <div style="margin-top:10px">
            <div class="small muted">Overall Progress</div>
            <div class="progress" style="margin-top:6px"><i id="overallFill" style="width:0%"></i></div>
          </div>
        </div>
      </div>

      <div class="stat">
        <strong>Quick Actions</strong>
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:10px">
          <button id="markAllDone" class="btn ghost">Mark All Done</button>
          <button id="deleteCompleted" class="btn ghost">Delete Completed</button>
          <button id="downloadSample" class="btn">Download Sample</button>
        </div>
      </div>

      <div class="stat">
        <strong>Theme</strong>
        <div style="margin-top:8px" class="small muted">Toggle animations & theme</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="animToggle" class="btn ghost">Toggle Anim</button>
          <button id="lightToggle" class="btn ghost">Light Mode</button>
        </div>
      </div>
    </aside>
  </div>

<script>
/* -------------------------
   Premium To-Do App Script
   ------------------------- */

(() => {
  // Storage key
  const KEY = 'premium_todo_v1';

  // DOM
  const taskTitle = el('#taskTitle');
  const taskSub = el('#taskSub');
  const taskNotes = el('#taskNotes');
  const taskDue = el('#taskDue');
  const taskPriority = el('#taskPriority');
  const taskCategory = el('#taskCategory');
  const addBtn = el('#addBtn');
  const clearBtn = el('#clearBtn');
  const tasksList = el('#tasksList');
  const summarySmall = el('#summarySmall');
  const overallFill = el('#overallFill');
  const countsEl = el('#counts');
  const searchInput = el('#searchInput');
  const filterCategory = el('#filterCategory');
  const filterStatus = el('#filterStatus');
  const sortBy = el('#sortBy');
  const exportBtn = el('#exportBtn');
  const importBtn = el('#importBtn');
  const importFile = el('#importFile');
  const markAllDone = el('#markAllDone');
  const deleteCompleted = el('#deleteCompleted');
  const downloadSample = el('#downloadSample');
  const animToggle = el('#animToggle');
  const lightToggle = el('#lightToggle');
  const themeToggle = el('#themeToggle');

  // State
  let tasks = loadTasks();
  let animationsEnabled = true;
  let lightMode = false;

  // Init
  render();
  bindEvents();
  updateSummary();

  // ---------- helpers ----------
  function el(sel){ return document.querySelector(sel) }
  function qsa(sel){ return Array.from(document.querySelectorAll(sel)) }
  function uid(prefix='t_'){ return prefix + Math.random().toString(36).slice(2,9) }

  function saveTasks(){
    try{ localStorage.setItem(KEY, JSON.stringify(tasks)); }catch(e){}
    updateSummary();
  }
  function loadTasks(){
    try{
      const raw = localStorage.getItem(KEY);
      return raw ? JSON.parse(raw) : [];
    }catch(e){ return [] }
  }

  function computePercent(task){
    if (task.manualPercent != null && task.manualPercent !== '') {
      const p = parseFloat(task.manualPercent);
      if (!isNaN(p)) return Math.max(0, Math.min(100, p));
    }
    const subs = task.subtasks || [];
    if (subs.length === 0) return task.completed ? 100 : 0;
    const done = subs.filter(s => s.done).length;
    return Math.round((done / subs.length) * 100);
  }

  function overallPercent(){
    if (!tasks.length) return 0;
    const sum = tasks.reduce((a,t)=> a + computePercent(t), 0);
    return Math.round(sum / tasks.length);
  }

  function formatDate(d){
    if(!d) return '';
    try{ const dt = new Date(d); return dt.toLocaleDateString(); }catch(e){ return d }
  }

  // ---------- UI actions ----------
  addBtn.addEventListener('click', ()=> {
    const title = taskTitle.value.trim();
    if (!title) { alert('Please enter a task title'); taskTitle.focus(); return; }
    const subs = (taskSub.value || '').split(',').map(s=>s.trim()).filter(Boolean).map(s=>({ id: uid('s_'), title: s, done: false }));
    const t = {
      id: uid(),
      title,
      notes: taskNotes.value.trim(),
      due: taskDue.value || null,
      priority: taskPriority.value,
      category: taskCategory.value || 'General',
      subtasks: subs,
      createdAt: new Date().toISOString(),
      manualPercent: null,
      completed: false
    };
    tasks.unshift(t);
    clearCreate();
    saveTasks();
    render();
    pulseAdd();
  });

  clearBtn.addEventListener('click', ()=> {
    if (!confirm('Clear ALL tasks? This cannot be undone.')) return;
    tasks = [];
    saveTasks();
    render();
  });

  exportBtn.addEventListener('click', ()=> {
    const blob = new Blob([JSON.stringify(tasks,null,2)],{type:'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'tasks.json'; a.click();
    URL.revokeObjectURL(a.href);
  });

  importBtn.addEventListener('click', ()=> importFile.click());
  importFile.addEventListener('change', (e)=>{
    const f = e.target.files[0]; if(!f) return;
    const r = new FileReader();
    r.onload = ()=> {
      try{
        const dt = JSON.parse(r.result);
        if (!Array.isArray(dt)) throw new Error('Invalid format');
        // merge with existing (but keep unique ids)
        const merged = [...dt, ...tasks].filter((v,i,a)=> a.findIndex(x=>x.id===v.id)===i);
        tasks = merged;
        saveTasks(); render();
        alert('Imported ' + dt.length + ' tasks');
      }catch(err){ alert('Import failed: ' + err.message) }
    };
    r.readAsText(f);
    importFile.value = '';
  });

  searchInput.addEventListener('input', debounce(render, 240));
  filterCategory.addEventListener('change', render);
  filterStatus.addEventListener('change', render);
  sortBy.addEventListener('change', render);

  markAllDone.addEventListener('click', ()=> {
    tasks = tasks.map(t=> ({ ...t, subtasks: (t.subtasks||[]).map(s=>({...s,done:true})), manualPercent: 100, completed: true }));
    saveTasks(); render();
  });

  deleteCompleted.addEventListener('click', ()=> {
    if(!confirm('Delete all completed tasks?')) return;
    tasks = tasks.filter(t => computePercent(t) < 100);
    saveTasks(); render();
  });

  downloadSample.addEventListener('click', ()=> {
    const sample = [
      { id: uid(), title: 'Design project UI', notes:'Add dark theme & animated shapes', priority:'high', category:'Work', subtasks:[{id:uid('s'),title:'Wireframe',done:true},{id:uid('s'),title:'Colors',done:false}], createdAt:new Date().toISOString(), manualPercent:null, completed:false },
      { id: uid(), title: 'Study DBMS', notes:'Read chapters & practice queries', priority:'medium', category:'Study', subtasks:[], createdAt:new Date().toISOString(), manualPercent:40, completed:false }
    ];
    const blob = new Blob([JSON.stringify(sample,null,2)],{type:'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'sample_tasks.json'; a.click();
    URL.revokeObjectURL(a.href);
  });

  animToggle.addEventListener('click', ()=> {
    animationsEnabled = !animationsEnabled;
    document.querySelectorAll('.task').forEach(el => {
      if (!animationsEnabled) {
        el.style.transition = 'none';
        el.style.transform = 'none';
      } else {
        el.style.transition = '';
      }
    });
    animToggle.textContent = animationsEnabled ? 'Anim On' : 'Anim Off';
  });

  lightToggle.addEventListener('click', ()=> {
    lightMode = !lightMode;
    document.body.style.background = lightMode ? 'linear-gradient(180deg,#f8fafc,#e6eef8)' : '';
    lightToggle.textContent = lightMode ? 'Dark Mode' : 'Light Mode';
  });

  themeToggle.addEventListener('click', ()=> {
    document.body.classList.toggle('alt-theme');
    // quick visual pulse
    document.body.animate([{filter:'brightness(1.1)'},{filter:'brightness(1)'}],{duration:360});
  });

  // ---------- Interactive functions ----------
  function toggleSub(taskId, subId){
    const t = tasks.find(x=>x.id===taskId); if(!t) return;
    t.subtasks = t.subtasks.map(s=> s.id===subId ? {...s, done: !s.done} : s );
    t.manualPercent = null;
    t.completed = computePercent(t)===100;
    saveTasks(); render();
  }

  function toggleComplete(taskId){
    const t = tasks.find(x=>x.id===taskId); if(!t) return;
    if (computePercent(t)===100){
      // mark pending
      if (t.subtasks && t.subtasks.length) t.subtasks = t.subtasks.map(s=>({...s, done:false}));
      else t.manualPercent = 0;
      t.completed = false;
    } else {
      if (t.subtasks && t.subtasks.length) t.subtasks = t.subtasks.map(s=>({...s, done:true}));
      else t.manualPercent = 100;
      t.completed = true;
    }
    saveTasks(); render();
  }

  function removeTask(taskId){
    if (!confirm('Delete task?')) return;
    tasks = tasks.filter(t => t.id !== taskId);
    saveTasks(); render();
  }

  function editTask(taskId){
    const t = tasks.find(x=>x.id===taskId); if(!t) return;
    const newTitle = prompt('Edit title', t.title);
    if (newTitle === null) return;
    t.title = newTitle.trim() || t.title;
    t.notes = prompt('Notes', t.notes || '') || t.notes;
    const mp = prompt('Manual percent (leave empty to auto-calc)', t.manualPercent != null ? t.manualPercent : '');
    t.manualPercent = mp === '' || mp === null ? null : Math.max(0, Math.min(100, parseInt(mp||0)));
    saveTasks(); render();
  }

  // ---------- Render ----------
  function render(){
    // filter & search & sort
    const q = (searchInput.value || '').toLowerCase().trim();
    let list = [...tasks];
    const fc = filterCategory.value;
    const fs = filterStatus.value;
    const sb = sortBy.value;

    if (fc !== 'all') list = list.filter(t => (t.category||'General') === fc);
    if (fs === 'completed') list = list.filter(t => computePercent(t) === 100);
    if (fs === 'pending') list = list.filter(t => computePercent(t) < 100);
    if (q) list = list.filter(t => (t.title + ' ' + (t.notes||'') + ' ' + (t.category||'')).toLowerCase().includes(q));

    if (sb === 'created') list.sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt));
    if (sb === 'due') list.sort((a,b)=> (a.due||'9999') > (b.due||'9999') ? 1 : -1);
    if (sb === 'priority') list.sort((a,b)=> priorityVal(b.priority) - priorityVal(a.priority));
    if (sb === 'percent') list.sort((a,b)=> computePercent(b) - computePercent(a));

    // render
    tasksList.innerHTML = '';
    for (const t of list){
      const p = computePercent(t);
      const div = document.createElement('div');
      div.className = 'task';
      div.innerHTML = `
        <div class="left">
          <div class="avatar">${p}%</div>
          <div class="meta">${formatDate(t.due)}</div>
        </div>
        <div>
          <div class="title">${escapeHtml(t.title)}</div>
          <div class="desc">${escapeHtml(t.notes || '')}</div>
          <div class="badges" style="margin-top:8px">
            <div class="badge">${escapeHtml(t.category || 'General')}</div>
            <div class="badge">Priority: ${t.priority}</div>
            <div class="badge small muted">Created: ${new Date(t.createdAt).toLocaleString()}</div>
          </div>
          <div style="margin-top:8px">
            <div class="progress"><i style="width:${p}%"></i></div>
          </div>
        </div>
        <div class="actions">
          <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
            <div style="display:flex;gap:6px">
              <button class="btn ghost small" data-act="edit" title="Edit">Edit</button>
              <button class="btn ghost small" data-act="toggle" title="Toggle Complete">${p===100 ? 'Uncomplete' : 'Complete'}</button>
            </div>
            <div style="display:flex;gap:6px">
              <button class="btn ghost small" data-act="remove" title="Delete">Delete</button>
            </div>
          </div>
        </div>
      `;

      // attach subtask list below title if present
      if (t.subtasks && t.subtasks.length){
        const subwrap = document.createElement('div');
        subwrap.style.marginTop = '10px';
        subwrap.style.display = 'flex';
        subwrap.style.flexDirection = 'column';
        subwrap.style.gap = '6px';
        for (const s of t.subtasks){
          const r = document.createElement('label');
          r.style.display = 'flex';
          r.style.alignItems = 'center';
          r.style.gap = '8px';
          r.innerHTML = `<input type="checkbox" ${s.done ? 'checked':''} /> <span style="font-size:13px; color:${s.done ? '#84cc16' : 'var(--muted)'}">${escapeHtml(s.title)}</span>`;
          r.querySelector('input').addEventListener('change', ()=> toggleSub(t.id, s.id));
          subwrap.appendChild(r);
        }
        div.querySelector('div:nth-child(2)').appendChild(subwrap);
      }

      // actions
      div.querySelector('[data-act="remove"]').addEventListener('click', ()=> removeTask(t.id));
      div.querySelector('[data-act="edit"]').addEventListener('click', ()=> editTask(t.id));
      div.querySelector('[data-act="toggle"]').addEventListener('click', ()=> toggleComplete(t.id));

      // animate entry
      if (animationsEnabled) {
        div.style.opacity = 0;
        div.style.transform = 'translateY(12px)';
        setTimeout(()=> {
          div.style.transition = 'opacity .38s cubic-bezier(.2,.9,.2,1), transform .38s cubic-bezier(.2,.9,.2,1)';
          div.style.opacity = 1;
          div.style.transform = 'translateY(0)';
        }, 16);
      }

      tasksList.appendChild(div);
    }

    // update progress bars if any
    overallFill.style.width = overallPercent() + '%';
    summarySmall.textContent = `${tasks.length} tasks • Overall: ${overallPercent()}%`;
    countsEl.textContent = `Completed: ${tasks.filter(t=>computePercent(t)===100).length} • Pending: ${tasks.filter(t=>computePercent(t)<100).length}`;
  }

  // ---------- utilities ----------
  function escapeHtml(s){ return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
  function priorityVal(p){ return p==='high'?3: p==='medium'?2:1; }
  function clearCreate(){ taskTitle.value=''; taskSub.value=''; taskNotes.value=''; taskDue.value=''; taskPriority.value='medium'; taskCategory.value='General'; }
  function pulseAdd(){
    addBtn.animate([{transform:'scale(1)'},{transform:'scale(1.04)'},{transform:'scale(1)'}],{duration:320});
  }
  function debounce(fn,wait){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=> fn.apply(this,a), wait); } }

  // ---------- keyboard shortcuts ----------
  window.addEventListener('keydown', (e)=>{
    if (e.key.toLowerCase()==='n' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA'){
      e.preventDefault(); taskTitle.focus();
    }
    if (e.key === 'Escape'){ taskTitle.blur(); }
  });

  // ---------- summary update ----------
  function updateSummary(){
    // update counts & overall
    const overall = overallPercent();
    overallFill.style.width = overall + '%';
    summarySmall.textContent = `${tasks.length} tasks • Overall: ${overall}%`;
    countsEl.textContent = `Completed: ${tasks.filter(t=>computePercent(t)===100).length} • Pending: ${tasks.filter(t=>computePercent(t)<100).length}`;
  }

  // ---------- sample local data if empty ----------
  if (!tasks.length){
    tasks = [
      { id: uid(), title: 'Design premium UI', notes: 'Add animated background shapes and glass effect', due: null, priority: 'high', category: 'Work', subtasks: [{id: uid('s'), title: 'Wireframes', done: true}, {id: uid('s'), title: 'Colors & Typography', done: false}], createdAt: new Date().toISOString(), manualPercent: null, completed:false },
      { id: uid(), title: 'Write project README', notes: 'Describe features & deployment steps', due: null, priority: 'medium', category: 'General', subtasks: [], createdAt: new Date().toISOString(), manualPercent: 20, completed:false }
    ];
    saveTasks();
  }

  // ---------- keyboard focus on load ----------
  window.addEventListener('load', ()=> { taskTitle.focus(); });

  // ---------- helper: attach event shorteners (already above) ----------

  // expose for dev console if needed
  window._premiumTodo = {
    getTasks: ()=> tasks,
    setTasks: (t)=> { tasks = t; saveTasks(); render(); }
  };

  // ---------- initial render & save ----------
  saveTasks();
  render();

})();
</script>
</body>
</html>
